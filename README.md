# Code for the Xinjiang high-resolution WRF–3DVAR meteorological dataset
﻿
This repository contains the main scripts used to generate and evaluate the high-resolution meteorological data products over Xinjiang based on the WRF/WRFDA 3DVAR system and ANUSPLIN, as well as MATLAB codes used for validation and figure production in the associated manuscript.
﻿
> **Important:**  
> - The codes are provided for non-commercial research use and are intended as an implementation reference for the workflow described in the paper.
﻿
---
﻿
## 1. Contents
﻿
The repository (code archive) includes three main groups of scripts:
﻿
1. **WRF–3DVAR assimilation example**
- `scheme1.sh`  
Job script for a 5-day assimilation and forecast case over Xinjiang (from 2017-01-01 00:00 UTC to 2017-01-06 00:00 UTC).  
It sequentially runs:
- WPS (geogrid, ungrib, metgrid)
- `real.exe` (initial and boundary conditions)
- WRFDA `obsproc` (observation preprocessing)
- `da_wrfvar.exe` (3DVAR assimilation)
- `da_update_bc.exe` (lateral boundary update)
- `wrf.exe` (5-day WRF integration)
- `namelist.wps`  
WPS configuration template defining the nested domains over Xinjiang, map projection and geographic data paths.
- `namelist.input`  
WRF integration namelist specifying the simulation period, grid configuration, physical parameterization schemes (microphysics, cumulus, radiation, PBL, land surface) and output settings.
- `namelist.obsproc.3dvar.xinjiang`  
WRFDA `obsproc` namelist for observation preprocessing, including analysis times, time window, and observation types written to ASCII files.
- `namelist.input.3dvar.xinjiang`  
WRFDA 3DVAR namelist controlling analysis time, background and observation files, background error statistics, activated observation types and iteration/convergence settings.
﻿
This example illustrates how a single high-resolution assimilation and forecast task is organized and executed in an independent working directory (e.g. `scheme1/`) as used in the production workflow.
﻿
2. **Validation and plotting scripts**
﻿
MATLAB scripts for evaluation of the dataset against withheld station observations and for generating figures in the manuscript:
﻿
- `figure4.m`  
Plots the **seasonal cycles of domain-mean daily variables**.  
Using 2 m temperature as an example, it reads daily mean values at the 30 withheld stations for:
- Station observations  
- CN05.1  
- 3DVAR-XJ-S  
- 3DVAR-MF-XJ-S  
- ERA5  
- ERA5-Land  
from `all_all.mat`, and produces **Figure 4**: seasonal cycles of domain-mean daily 2 m temperature, precipitation, 10 m wind speed, relative humidity, surface pressure and downward shortwave radiation.
﻿
- `figure5.m`  
Plots the **time series of annual mean variables**.  
Using temperature as an example, it reads annual mean values at the withheld stations from `all_all.mat` for the same set of products and generates **Figure 5** (annual mean time series).
﻿
- `figure6.m`  
Produces **boxplots of AE, CC, RMSE and DISO** based on daily data at the 30 withheld stations.  
Using temperature as an example, it reads daily series from `all30.mat` for station observations, CN05.1, 3DVAR-XJ-S, 3DVAR-MF-XJ-S, ERA5 and ERA5-Land, and outputs **Figure 6**.
﻿
The figures in the manuscript were obtained by applying minor adjustments to colours and layout in standard graphics software on top of the plots generated by these scripts.
﻿
## 2. Requirements
﻿
### 2.1. Model and data assimilation system
﻿
To run the WRF–3DVAR example case or adapt the workflow, you will need:
﻿
- **WRF** (with WPS and WRFDA) compiled and installed on your system (Linux/HPC environment recommended).
- **ANUSPLIN** (licensed interpolation package).  
This software is **not** distributed in this repository and must be obtained from the official provider.
﻿
### 2.2. Data
﻿
The workflow relies on:
﻿
- Large-scale reanalysis data (e.g. ERA5) for model forcing.
- Surface station observations over Xinjiang for 3DVAR assimilation and validation.
﻿
> The records from the **30 withheld validation stations** are operational observations from the Chinese meteorological network and are subject to confidentiality and data-sharing restrictions.  
> They are **not redistributed** here; users should obtain comparable station data from the relevant data provider if they wish to reproduce the full workflow.
﻿
### 2.3. Software environment
﻿
- MATLAB (for running the validation and plotting scripts)
- Standard UNIX shell environment (for `scheme1.sh`)
- Optional: NCO/CDO or similar tools for manipulating NetCDF files
## 3. How to use the scripts
﻿
### 3.1. WRF–3DVAR example case
﻿
1. Adjust paths in `scheme1.sh` to match your local installation of WRF/WPS/WRFDA, geogrid data and working directories.
2. Edit `namelist.wps`, `namelist.input`, `namelist.obsproc.3dvar.xinjiang` and `namelist.input.3dvar.xinjiang` if you wish to change the domain, period or data sources.
3. Submit `scheme1.sh` to your batch system to perform the 5-day assimilation and forecast for the Xinjiang domain.
﻿
This example is intended as a template; users can adapt it to other periods or regions by modifying the namelist files and paths.
﻿
### 3.2. Validation and plotting
﻿
1. Prepare the MATLAB input files:
- `all_all.mat` containing domain-mean daily and annual mean series for each dataset and the withheld stations.
- `all30.mat` containing daily series at each withheld station for each dataset.
2. Open MATLAB in the directory containing the scripts and `.mat` files.
3. Run:
```matlab
figure4    % Seasonal cycles (Figure 4)
figure5    % Annual time series (Figure 5)
figure6    % Boxplots of AE, CC, RMSE, DISO (Figure 6)
﻿
---
﻿
﻿
